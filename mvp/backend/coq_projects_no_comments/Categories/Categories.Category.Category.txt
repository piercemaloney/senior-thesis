From Categories Require Import Essentials.Notations.

From Categories Require Import Essentials.Types.

From Categories Require Import Essentials.Facts_Tactics.



Cumulative Class Category : Type :=

{

  

  Obj : Type;



  Hom : Obj → Obj → Type where "a –≻ b" := (Hom a b);



  compose : ∀ {a b c : Obj}, (a –≻ b) → (b –≻ c) → (a –≻ c) where "f ∘ g" := (compose g f);



  assoc : ∀ {a b c d : Obj} (f : a –≻ b) (g : b –≻ c) (h : c –≻ d),

            ((h ∘ g) ∘ f) = (h ∘ (g ∘ f));



  assoc_sym : ∀ {a b c d : Obj} (f : a –≻ b) (g : b –≻ c) (h : c –≻ d),

                ((h ∘ (g ∘ f) = (h ∘ g) ∘ f));



  id : ∀ {a : Obj}, a –≻ a;



  id_unit_left : ∀ (a b : Obj) (h : a –≻ b), id ∘ h = h;



  id_unit_right : ∀ (a b : Obj) (h : a –≻ b), h ∘ id = h

}.



Arguments Obj {_}, _.

Arguments id {_ _}, {_} _, _ _.

Arguments Hom {_} _ _, _ _ _.

Arguments compose {_} {_ _ _} _ _, _ {_ _ _} _ _, _ _ _ _ _ _.

Arguments assoc {_ _ _ _ _} _ _ _.

Arguments assoc_sym {_ _ _ _ _} _ _ _.



Notation "f ∘ g" := (compose g f) : morphism_scope.

Notation "a –≻ b" := (Hom a b) : morphism_scope.



Bind Scope category_scope with Category.



Bind Scope morphism_scope with Hom.



Bind Scope object_scope with Obj.



Coercion Obj : Category >-> Sortclass.



Hint Resolve id_unit_left id_unit_right.



Ltac simpl_ids :=

  let id_detected B :=

      let J := fresh "H" in

      cut (B = id); [intros J; rewrite J; clear J | trivial]

  in

  repeat(

      match goal with

        | [|- context[(?A ∘ id)%morphism] ] => rewrite id_unit_right

        | [|- context[(id ∘ ?A)%morphism] ] => rewrite id_unit_left

        | [|- (?A ∘ ?B)%morphism = ?A] => id_detected B

        | [|- (?A = ?A ∘ ?B) %morphism] => id_detected B

        | [|- (?B ∘ ?A = ?A)%morphism] => id_detected B

        | [|- (?A = ?B ∘ ?A)%morphism] => id_detected B

      end

    )

.



Ltac simpl_ids_in_I I :=

  repeat(

      match type of I with

        | context[(?A ∘ id)%morphism] => rewrite id_unit_right in I

        | context[(id ∘ ?A)%morphism] => rewrite id_unit_left in I

      end

    )

.



Tactic Notation "simpl_ids" := simpl_ids.



Tactic Notation "simpl_ids" "in" hyp(I) := simpl_ids_in_I I.



Hint Extern 1 => progress simpl_ids.



Hint Extern 3 => progress (dohyps (fun H => simpl_ids in H)).



Hint Extern 2 =>

match goal with

    [|- ?A = ?B :> Hom _ _ _] =>

    repeat rewrite assoc; trivial; fail

end.



Hint Extern 2 =>

match goal with

  [H : _ = _ :> Hom _ _ _ |- _ = _ :> Hom _ _ _] =>

  repeat rewrite assoc in H;

    repeat rewrite assoc;

    (idtac + symmetry); apply H

end.

