
Require Import Bool.

Inductive word : Set :=
  | empty : word
  | bit : bool -> word -> word.

Inductive conc : word -> word -> word -> Prop :=
  | conc_empty : forall v : word, conc empty v v
  | conc_bit :
      forall (u v w : word) (b : bool),
      conc u v w -> conc (bit b u) v (bit b w).

Fixpoint append (u : word) : word -> word :=
  fun v : word =>
  match u with
  | empty => v
  | bit b w => bit b (append w v)
  end. 

Lemma conc_append : forall u v w : word, conc u v w -> w = append u v.
Proof.
simple induction 1; simpl in |- *; trivial.
simple induction 2; trivial.
Qed.

Lemma assoc_append :
 forall u v w : word, append u (append v w) = append (append u v) w.
Proof.
simple induction u; simpl in |- *; intros; auto.
rewrite H; trivial.
Qed.

Definition single (b : bool) := bit b empty.

Inductive odd : word -> Prop :=
    even_odd : forall w : word, even w -> forall b : bool, odd (bit b w)
with even : word -> Prop :=
  | even_empty : even empty
  | odd_even : forall w : word, odd w -> forall b : bool, even (bit b w).

Hint Resolve odd_even even_empty even_odd.

Lemma not_odd_empty : ~ odd empty.
Proof.
unfold not in |- *; intro od.
inversion od.
Qed.

Hint Resolve not_odd_empty.

Lemma inv_odd : forall (w : word) (b : bool), odd (bit b w) -> even w.
Proof.
intros w b od.
inversion od; trivial.
Qed.

Lemma inv_even : forall (w : word) (b : bool), even (bit b w) -> odd w.
Proof.
intros w b ev.
inversion ev; trivial.
Qed.

Lemma odd_or_even : forall w : word, odd w \/ even w.
Proof.
simple induction w; auto.
simple induction 1; intros.
right; auto.
left; auto.
Qed.

Lemma not_odd_and_even : forall w : word, odd w -> even w -> False.
Proof.
simple induction w; intros.
elim not_odd_empty; trivial.
apply H.
apply inv_even with b; trivial.
apply inv_odd with b; trivial.
Qed.

Lemma odd_even_conc :
 forall u v w : word,
 conc u v w ->
 odd w /\ (odd u /\ even v \/ even u /\ odd v) \/
 even w /\ (odd u /\ odd v \/ even u /\ even v).
Proof.
simple induction 1; intros.
elim (odd_or_even v0); auto.
elim H1; [ right | left ]; intuition.
Qed.

Lemma even_conc :
 forall u v w : word,
 conc u v w -> even w -> odd u /\ odd v \/ even u /\ even v.
Proof.
intros u v w c e; elim odd_even_conc with u v w; intros.
elim H; intro o; elim not_odd_and_even with w; auto.
elim H; intros; trivial.
trivial.
Qed.
